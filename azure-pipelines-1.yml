trigger:
 - main
pool:
  name:  'myvmsspool'

variables:

- name: file_CACHE_DIRECTORY
  value: $(Agent.ToolsDirectory)/File

parameters:
- name: file
  displayName: files list
  type: object
  default:
    - file1.txt
    - file2.txt 
    - file3.txt 
  
jobs:
- job: test 
  displayName: 'Build Files in Parallel'
  steps:
       
  - task: PowerShell@2
    inputs:
        targetType: inline
        script: |
              $Destination = $(file_CACHE_DIRECTORY)
              $StorageAccountName="mystorage15689 " 
              $StorageAccountKey= "AbF/p5UmVVU4CwV6zxuVuO/fsMuWdPwkGdwsSzLv6Pkr+RkAIABKmLMXyO5yr84ftClD9XcH7kBD+AStI3x+zQ=="

              Import-Module Az.Storage
              

              if (-Not (Test-Path -Path $Destination -PathType Container)) {
                New-Item -Path $Destination -ItemType Directory
              }
              $context = New-AzStorageContext -StorageAccountName $StorageAccountName -StorageAccountKey $StorageAccountKey
            
                if (-Not (Test-Path -Path "$Destination/$file" -PathType Leaf)) {
                  Write-Host -NoNewline "Downloading $file... "
                  Get-AzStorageFileContent -ShareName myfile -Path "$file" -Context $context -Destination $Destination
                  Write-Host "done"
                else {
                  Write-Host "Skipping $file (cached)"
                }
              }

    displayName: Download file

  - task: PowerShell@2
    inputs:
         script: echo "This is the content of the file." > file.txt

    displayName: Environment